<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>é»æ•¸æ‰£é™¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <h2>â¤ï¸ æƒ…ä¾¶é»æ•¸æ‰£é™¤</h2>

  <p>å¡ç‰‡ IDï¼š</p>
  <input id="cardId" placeholder="æƒæå¾Œè‡ªå‹•å¡«å…¥" readonly />

  <p>æ‰£é™¤é»æ•¸ï¼š</p>
  <input id="amount" type="number" min="1" value="1" />

  <br /><br />
  <button onclick="redeem()">ç¢ºèªæ‰£é»</button>

  <p id="result"></p>

  <script>
    // ğŸ”¹ æ‰‹å‹•è²¼ä¸Š Apps Script Web App URL
    const API_URL = "https://script.google.com/macros/s/AKfycbyzTLn0yJifd0fn7jlX0NHfDI4iGWuijIQB6W1WopBlQOK0Ao-5P26-dcSroOaysprP_A/exec";

    // ğŸ”¹ è®“ä½ å¯ä»¥ç”¨ã€Œæƒ QR Code å¾Œè²¼ä¸Šã€
    if (location.hash) {
      document.getElementById("cardId").value =
        decodeURIComponent(location.hash.substring(1));
    }

    async function redeem() {
      const cardId = document.getElementById("cardId").value;
      const amount = document.getElementById("amount").value;

      if (!cardId) {
        alert("æ²’æœ‰å¡ç‰‡ ID");
        return;
      }

      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({
          card_id: cardId,
          amount: amount
        })
      });

      const data = await res.json();
      if (data.error) {
        document.getElementById("result").innerText = "âŒ " + data.error;
      } else {
        document.getElementById("result").innerText =
          "âœ… æ‰£é»æˆåŠŸï¼Œå‰©é¤˜ï¼š" + data.balance;
      }
    }
  </script>
</body>
</html>
